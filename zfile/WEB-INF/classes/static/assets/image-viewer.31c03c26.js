var ze=Object.defineProperty,Ie=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var pe=(n,l,a)=>l in n?ze(n,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[l]=a,W=(n,l)=>{for(var a in l||(l={}))Ce.call(l,a)&&pe(n,a,l[a]);if(fe)for(var a of fe(l))Ee.call(l,a)&&pe(n,a,l[a]);return n},Q=(n,l)=>Ie(n,Le(l));var me=(n,l,a)=>new Promise((r,p)=>{var y=d=>{try{R(a.next(d))}catch(m){p(m)}},s=d=>{try{R(a.throw(d))}catch(m){p(m)}},R=d=>d.done?r(d.value):Promise.resolve(d.value).then(y,s);R((a=a.apply(n,l)).next())});import{m as ge,u as V}from"./request.29c9df35.js";import{d as ee,an as ve,r as b,ao as Te,s as Se,c as k,w as re,P as we,o as he,a as x,b as ie,j as u,e as C,m as h,g as f,u as t,n as se,h as Ne,k as z,f as O,F as ce,l as Oe,v as Re,J as $e,K as Ye,i as U,T as Ae,N as Xe,ap as Be,x as Ve,t as Me}from"./index.f20a2340.js";import{Q as B,S as Fe,b as ye,d as ue,a8 as de,aE as je,aF as De,n as _e,a as be,J as He,E as N,i as Pe,aG as We,am as Ze,aH as Je,z as Ge,aI as Ke,aJ as qe,_ as ke,av as X,aw as Qe,w as xe,at as Ue,k as et,u as tt}from"./base.f9e60852.js";import{d as at}from"./debounce.0dcbc4e4.js";import{u as nt}from"./index.2085544e.js";import{g as ot}from"./scroll.5771f43f.js";const lt=(n,l)=>{if(!B||!n||!l)return!1;const a=n.getBoundingClientRect();let r;return l instanceof Element?r=l.getBoundingClientRect():r={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},a.top<r.bottom&&a.bottom>r.top&&a.right>r.left&&a.left<r.right},Et=n=>{let l,a;return n.type==="touchend"?(a=n.changedTouches[0].clientY,l=n.changedTouches[0].clientX):n.type.startsWith("touch")?(a=n.touches[0].clientY,l=n.touches[0].clientX):(a=n.clientY,l=n.clientX),{clientX:l,clientY:a}};var rt="Expected a function";function le(n,l,a){var r=!0,p=!0;if(typeof n!="function")throw new TypeError(rt);return Fe(a)&&(r="leading"in a?!!a.leading:r,p="trailing"in a?!!a.trailing:p),at(n,l,{leading:r,maxWait:l,trailing:p})}const it=ye({urlList:{type:ue(Array),default:()=>ge([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),st={close:()=>!0,switch:n=>de(n)},ct=["src"],ut=ee({name:"ElImageViewer"}),dt=ee(Q(W({},ut),{props:it,emits:st,setup(n,{expose:l,emit:a}){const r=n,p={CONTAIN:{name:"contain",icon:ve(je)},ORIGINAL:{name:"original",icon:ve(De)}},{t:y}=_e(),s=be("image-viewer"),{nextZIndex:R}=He(),d=b(),m=b([]),I=Te(),L=b(!0),v=b(r.initialIndex),g=Se(p.CONTAIN),c=b({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),M=k(()=>{const{urlList:e}=r;return e.length<=1}),$=k(()=>v.value===0),Z=k(()=>v.value===r.urlList.length-1),te=k(()=>r.urlList[v.value]),F=k(()=>{const{scale:e,deg:o,offsetX:i,offsetY:w,enableTransition:T}=c.value;let _=i/e,S=w/e;switch(o%360){case 90:case-270:[_,S]=[S,-_];break;case 180:case-180:[_,S]=[-_,-S];break;case 270:case-90:[_,S]=[-S,_];break}const A={transform:`scale(${e}) rotate(${o}deg) translate(${_}px, ${S}px)`,transition:T?"transform .3s":""};return g.value.name===p.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A}),ae=k(()=>de(r.zIndex)?r.zIndex:R());function Y(){ne(),a("close")}function j(){const e=le(i=>{switch(i.code){case X.esc:r.closeOnPressEscape&&Y();break;case X.space:H();break;case X.left:K();break;case X.up:E("zoomIn");break;case X.right:q();break;case X.down:E("zoomOut");break}}),o=le(i=>{const w=i.deltaY||i.deltaX;E(w<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});I.run(()=>{V(document,"keydown",e),V(document,"wheel",o)})}function ne(){I.stop()}function oe(){L.value=!1}function J(e){L.value=!1,e.target.alt=y("el.image.error")}function G(e){if(L.value||e.button!==0||!d.value)return;c.value.enableTransition=!1;const{offsetX:o,offsetY:i}=c.value,w=e.pageX,T=e.pageY,_=le(A=>{c.value=Q(W({},c.value),{offsetX:o+A.pageX-w,offsetY:i+A.pageY-T})}),S=V(document,"mousemove",_);V(document,"mouseup",()=>{S()}),e.preventDefault()}function D(){c.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function H(){if(L.value)return;const e=Qe(p),o=Object.values(p),i=g.value.name,T=(o.findIndex(_=>_.name===i)+1)%e.length;g.value=p[e[T]],D()}function P(e){const o=r.urlList.length;v.value=(e+o)%o}function K(){$.value&&!r.infinite||P(v.value-1)}function q(){Z.value&&!r.infinite||P(v.value+1)}function E(e,o={}){if(L.value)return;const{zoomRate:i,rotateDeg:w,enableTransition:T}=W({zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0},o);switch(e){case"zoomOut":c.value.scale>.2&&(c.value.scale=Number.parseFloat((c.value.scale/i).toFixed(3)));break;case"zoomIn":c.value.scale<7&&(c.value.scale=Number.parseFloat((c.value.scale*i).toFixed(3)));break;case"clockwise":c.value.deg+=w;break;case"anticlockwise":c.value.deg-=w;break}c.value.enableTransition=T}return re(te,()=>{we(()=>{const e=m.value[0];e!=null&&e.complete||(L.value=!0)})}),re(v,e=>{D(),a("switch",e)}),he(()=>{var e,o;j(),(o=(e=d.value)==null?void 0:e.focus)==null||o.call(e)}),l({setActiveItem:P}),(e,o)=>(x(),ie(Xe,{to:"body",disabled:!e.teleported},[u(Ae,{name:"viewer-fade",appear:""},{default:C(()=>[h("div",{ref_key:"wrapper",ref:d,tabindex:-1,class:f(t(s).e("wrapper")),style:se({zIndex:t(ae)})},[h("div",{class:f(t(s).e("mask")),onClick:o[0]||(o[0]=Ne(i=>e.hideOnClickModal&&Y(),["self"]))},null,2),z(" CLOSE "),h("span",{class:f([t(s).e("btn"),t(s).e("close")]),onClick:Y},[u(t(N),null,{default:C(()=>[u(t(Pe))]),_:1})],2),z(" ARROW "),t(M)?z("v-if",!0):(x(),O(ce,{key:0},[h("span",{class:f([t(s).e("btn"),t(s).e("prev"),t(s).is("disabled",!e.infinite&&t($))]),onClick:K},[u(t(N),null,{default:C(()=>[u(t(We))]),_:1})],2),h("span",{class:f([t(s).e("btn"),t(s).e("next"),t(s).is("disabled",!e.infinite&&t(Z))]),onClick:q},[u(t(N),null,{default:C(()=>[u(t(Ze))]),_:1})],2)],64)),z(" ACTIONS "),h("div",{class:f([t(s).e("btn"),t(s).e("actions")])},[h("div",{class:f(t(s).e("actions__inner"))},[u(t(N),{onClick:o[1]||(o[1]=i=>E("zoomOut"))},{default:C(()=>[u(t(Je))]),_:1}),u(t(N),{onClick:o[2]||(o[2]=i=>E("zoomIn"))},{default:C(()=>[u(t(Ge))]),_:1}),h("i",{class:f(t(s).e("actions__divider"))},null,2),u(t(N),{onClick:H},{default:C(()=>[(x(),ie(Oe(t(g).icon)))]),_:1}),h("i",{class:f(t(s).e("actions__divider"))},null,2),u(t(N),{onClick:o[3]||(o[3]=i=>E("anticlockwise"))},{default:C(()=>[u(t(Ke))]),_:1}),u(t(N),{onClick:o[4]||(o[4]=i=>E("clockwise"))},{default:C(()=>[u(t(qe))]),_:1})],2)],2),z(" CANVAS "),h("div",{class:f(t(s).e("canvas"))},[(x(!0),O(ce,null,Re(e.urlList,(i,w)=>$e((x(),O("img",{ref_for:!0,ref:T=>m.value[w]=T,key:i,src:i,style:se(t(F)),class:f(t(s).e("img")),onLoad:oe,onError:J,onMousedown:G},null,46,ct)),[[Ye,w===v.value]])),128))],2),U(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}}));var ft=ke(dt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const pt=xe(ft),mt=ye({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:ue([String,Object])},previewSrcList:{type:ue(Array),default:()=>ge([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),vt={load:n=>n instanceof Event,error:n=>n instanceof Event,switch:n=>de(n),close:()=>!0,show:()=>!0},gt=["src","loading"],wt={key:0},ht=ee({name:"ElImage",inheritAttrs:!1}),yt=ee(Q(W({},ht),{props:mt,emits:vt,setup(n,{emit:l}){const a=n;let r="";const{t:p}=_e(),y=be("image"),s=Be(),R=nt(),d=b(),m=b(!1),I=b(!0),L=b(!1),v=b(),g=b(),c=B&&"loading"in HTMLImageElement.prototype;let M,$;const Z=k(()=>s.style),te=k(()=>{const{fit:e}=a;return B&&e?{objectFit:e}:{}}),F=k(()=>{const{previewSrcList:e}=a;return Array.isArray(e)&&e.length>0}),ae=k(()=>{const{previewSrcList:e,initialIndex:o}=a;let i=o;return o>e.length-1&&(i=0),i}),Y=k(()=>a.loading==="eager"?!1:!c&&a.loading==="lazy"||a.lazy),j=()=>{!B||(I.value=!0,m.value=!1,d.value=a.src)};function ne(e){I.value=!1,m.value=!1,l("load",e)}function oe(e){I.value=!1,m.value=!0,l("error",e)}function J(){lt(v.value,g.value)&&(j(),H())}const G=tt(J,200);function D(){return me(this,null,function*(){var e;if(!B)return;yield we();const{scrollContainer:o}=a;Ue(o)?g.value=o:et(o)&&o!==""?g.value=(e=document.querySelector(o))!=null?e:void 0:v.value&&(g.value=ot(v.value)),g.value&&(M=V(g,"scroll",G),setTimeout(()=>J(),100))})}function H(){!B||!g.value||!G||(M==null||M(),g.value=void 0)}function P(e){if(!!e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function K(){!F.value||($=V("wheel",P,{passive:!1}),r=document.body.style.overflow,document.body.style.overflow="hidden",L.value=!0,l("show"))}function q(){$==null||$(),document.body.style.overflow=r,L.value=!1,l("close")}function E(e){l("switch",e)}return re(()=>a.src,()=>{Y.value?(I.value=!0,m.value=!1,H(),D()):j()}),he(()=>{Y.value?D():j()}),(e,o)=>(x(),O("div",{ref_key:"container",ref:v,class:f([t(y).b(),e.$attrs.class]),style:se(t(Z))},[d.value!==void 0&&!m.value?(x(),O("img",Ve({key:0},t(R),{src:d.value,loading:e.loading,style:t(te),class:[t(y).e("inner"),t(F)&&t(y).e("preview"),I.value&&t(y).is("loading")],onClick:K,onLoad:ne,onError:oe}),null,16,gt)):z("v-if",!0),I.value||m.value?(x(),O("div",{key:1,class:f(t(y).e("wrapper"))},[I.value?U(e.$slots,"placeholder",{key:0},()=>[h("div",{class:f(t(y).e("placeholder"))},null,2)]):m.value?U(e.$slots,"error",{key:1},()=>[h("div",{class:f(t(y).e("error"))},Me(t(p)("el.image.error")),3)]):z("v-if",!0)],2)):z("v-if",!0),t(F)?(x(),O(ce,{key:2},[L.value?(x(),ie(t(pt),{key:0,"z-index":e.zIndex,"initial-index":t(ae),infinite:e.infinite,"zoom-rate":e.zoomRate,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:q,onSwitch:E},{default:C(()=>[e.$slots.viewer?(x(),O("div",wt,[U(e.$slots,"viewer")])):z("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):z("v-if",!0)],64)):z("v-if",!0)],6))}}));var _t=ke(yt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const Tt=xe(_t);export{Tt as E,Et as g};
